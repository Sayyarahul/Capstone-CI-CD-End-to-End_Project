name: CI-CD Pipeline

on:
  push:
    branches: ["main"]

jobs:
  build-test-push:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    #  Login using CLI (NOT docker/login-action)
    - name: Docker Login
      run: |
        echo "${{ secrets.DOCKER_PASSWORD }}" | docker login \
          -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

    # ğŸ— Build backend
    - name: Build Backend Image
      run: |
        docker build ./backend -t rahulsayya/backend:latest

    # ğŸ— Build frontend
    - name: Build Frontend Image
      run: |
        docker build ./frontend -t rahulsayya/frontend:latest

    #  Push backend
    - name: Push Backend Image
      run: |
        docker push rahulsayya/backend:latest

    #  Push frontend
    - name: Push Frontend Image
      run: |
        docker push rahulsayya/frontend:latest
